rules_version = '2';

service cloud.firestore {

  match /databases/{database}/documents {

    /* Keep accounts protected (only the owner can read/update/create) */
    match /accounts/{userId} {
      allow create: if request.auth != null && request.auth.uid == userId;
      allow read, update: if request.auth != null && request.auth.uid == userId;
      allow delete: if false;
    }

    /* âœ… Allow READ access to top-level /events for now (US 01.01.03) */
    match /events/{eventId} {
      allow read: if true;      // ðŸ‘ˆ dev-only; tighten later
      allow write: if false;
    }

    /* (Optional) If some teams store events under subcollections too:
       /accounts/{uid}/events/{eventId}, etc. */
    match /{path=**}/events/{eventId} {
      allow read: if true;      // ðŸ‘ˆ dev-only; tighten later
      allow write: if false;
    }

    /* âœ… ADD THIS: Allow READ access to waiting_lists for now (US 01.05.04) */
    match /waiting_lists/{eventId} {
      allow read: if true;      // ðŸ‘ˆ dev-only; allow reading waiting list counts
      allow write: if false;    // ðŸ‘ˆ dev-only; tighten later when implementing join waitlist
      
      // Allow reading entries subcollection
      match /entries/{entryId} {
        allow read: if true;    // ðŸ‘ˆ dev-only; allow reading waiting list entries
        allow write: if false;   // ðŸ‘ˆ dev-only; tighten later when implementing join waitlist
      }
    }

    /* âœ… ADD THIS: Allow reading waiting_list_entries (alternative flat structure) */
    match /waiting_list_entries/{entryId} {
      allow read: if true;      // ðŸ‘ˆ dev-only; allow reading waiting list entries
      allow write: if false;   // ðŸ‘ˆ dev-only; tighten later when implementing join waitlist
    }

    /* Deny everything else by default */
    match /{document=**} {
      allow read, write: if false;
    }

  }

}


